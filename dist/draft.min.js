!function t(e,n,r){function i(s,u){if(!n[s]){if(!e[s]){var o="function"==typeof require&&require;if(!u&&o)return o(s,!0);if(a)return a(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return i(n?n:t)},l,l.exports,t,e,n,r)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t){"use strict";var e=function(t){return t&&t.__esModule?t["default"]:t},n=function(){function t(t,e){for(var n in e){var r=e[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(t,e)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=e(t("./dispatcher/Dispatcher.js")),a=e(t("./dispatcher/Events.js")),s=e(t("./components/shape/Rectangle.js")),u=e(t("./helpers/Zed.js")),o=e(t("./helpers/BoundingBox.js")),c=function(){function t(e,n){var s=this;r(this,t),this.shapes=[],this.index=1,this.keyboard={multiSelect:!1,aspectRatio:!1},this.options=Object.assign(this.getOptions(),n),this.dispatcher=new i,this.boundingBox=new o,this.boundingBox.setAccessor(this.getAccessor()),function(t){t.bind("mod+a",function(){return s.dispatcher.send(a.SELECT_ALL)}),t.bind("mod",function(){return s.keyboard.multiSelect=!0},"keydown"),t.bind("mod",function(){return s.keyboard.multiSelect=!1},"keyup"),t.bind("shift",function(){return s.keyboard.aspectRatio=!0},"keydown"),t.bind("shift",function(){return s.keyboard.aspectRatio=!1},"keyup")}(Mousetrap||{bind:function(){}}),this.svg=d3.select("string"==typeof e?document.querySelector(e):e).attr("width",this.options.documentWidth).attr("height",this.options.documentHeight).on("click",function(){}),this.groups={shapes:this.svg.append("g").attr("class","shapes").on("click",function(){return d3.event.stopPropagation()}),handles:this.svg.append("g").attr("class","handles").on("click",function(){return d3.event.stopPropagation()})}}return n(t,{add:{value:function(t){var e=this.getInstance(t),n=e.getFacade();return this.shapes.push(n),n}},on:{value:function(t,e){this.dispatcher.on(t,e)}},remove:{value:function(t){t.remove()}},getSelected:{value:function(){return this.shapes.filter(function(t){return t.isSelected()})}},getAccessor:{value:function(){var t=this;return{getSelected:this.getSelected.bind(this),groups:this.groups,dragBBox:function(){return t.boundingBox.dragStart()},createBBox:function(){return t.boundingBox.create(t.getSelected(),t.groups.handles)},keyboard:this.keyboard,hasSelected:function(){return t.dispatcher.send(a.SELECTED,{shapes:t.getSelected()})},selectAll:function(){return t.dispatcher.send(a.SELECT_ALL)},deselectAll:function(){return t.dispatcher.send(a.DESELECT_ALL)},remove:function(e){var n=t.shapes.indexOf(e);t.shapes.splice(n,1)},reorder:function(e){var n=t.svg.selectAll("g.shapes g");u.reorder(n,e)}}}},getInstance:{value:function(t){var e={rect:s},n=new(e[t.toLowerCase()]);return n.setAccessor(this.getAccessor()),n.setDispatcher(this.dispatcher),n.insert(this.groups.shapes,this.index++),n}},getOptions:{value:function(){return{documentHeight:"100%",documentWidth:"100%",gridSize:10}}}}),t}();Object.assign=Object.assign||function(t){for(var e=void 0,n=void 0,r=Object(t),i=1;i<arguments.length;i++){e=arguments[i],n=Object.keys(Object(e));for(var a=0;a<n.length;a++)r[n[a]]=e[n[a]]}return r},function(t){t.Draft=c}(window)},{"./components/shape/Rectangle.js":5,"./dispatcher/Dispatcher.js":7,"./dispatcher/Events.js":8,"./helpers/BoundingBox.js":9,"./helpers/Zed.js":10}],2:[function(t,e){"use strict";var n=function(){function t(t,e){for(var n in e){var r=e[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(t,e)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function t(e){r(this,t),this.shape=e,this.selected=!1}return n(t,{remove:{value:function(){this.shape.group.remove(),this.shape.accessor.remove(this)}},select:{value:function(){return this.shape.features.selectable.select(),this.shape.accessor.hasSelected(),this}},deselect:{value:function(){return this.shape.features.selectable.deselect(),this.shape.accessor.hasSelected(),this}},selectInvert:{value:function(){return this.selected?this.deselect():this.select(),this.shape.accessor.hasSelected(),this}},attribute:{value:function(t){var e=void 0===arguments[1]?null:arguments[1];return"z"===t?this.z(e):null===e?this.shape.element.datum()[t]:(this.shape.element.datum()[t]=e,this.shape.element.attr(t,e),this)}},transform:{value:function(){var t=void 0===arguments[0]?null:arguments[0],e=void 0===arguments[1]?null:arguments[1];return null===t&&null===e?[this.x(),this.y()]:this.attribute("transform","translate("+t+", "+e+")")}},x:{value:function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(){var t=void 0===arguments[0]?null:arguments[0];return null===t?this.parseTranslate(this.shape.element.datum().transform).x:this.transform(t,this.y())})},y:{value:function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(){var t=void 0===arguments[0]?null:arguments[0];return null===t?this.parseTranslate(this.shape.element.datum().transform).y:this.transform(this.x(),t)})},z:{value:function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(){var t=void 0===arguments[0]?null:arguments[0];return null===t?this.shape.group.datum().z:this.shape.group.datum().z=t})},dimension:{value:function(){var t=void 0===arguments[0]?null:arguments[0],e=void 0===arguments[1]?null:arguments[1];return null===t&&null===e?[this.height(),this.width()]:this.height(t).width(e)}},height:{value:function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(){var t=void 0===arguments[0]?null:arguments[0];return this.attribute("height",t)})},width:{value:function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(){var t=void 0===arguments[0]?null:arguments[0];return this.attribute("width",t)})},boundingBox:{value:function(){return this.shape.group.node().getBBox()}},bringToFront:{value:function(){return this.attribute("z",1/0),this.shape.accessor.reorder(this.shape.group),this}},bringForwards:{value:function(){return this.attribute("z",this.attribute("z")+1),this.shape.accessor.reorder(this.shape.group),this}},sendToBack:{value:function(){return this.attribute("z",-1/0),this.shape.accessor.reorder(this.shape.group),this}},sendBackwards:{value:function(){return this.attribute("z",this.attribute("z")-1),this.shape.accessor.reorder(this.shape.group),this}},getShape:{value:function(){return this.shape}},parseTranslate:{value:function(t){var e=String(t).match(/translate\(([0-9]+)\s*,\s*([0-9]+)/i);return{x:parseInt(e[1]),y:parseInt(e[2])}}},isSelected:{value:function(){return this.selected}}}),t}();e.exports=i},{}],3:[function(t,e){"use strict";var n=function(t){return t&&t.__esModule?t["default"]:t},r=function(){function t(t,e){for(var n in e){var r=e[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(t,e)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},a=n(t("./shape/feature/Selectable.js")),s=n(t("./../dispatcher/Events.js")),u=function(){function t(){i(this,t)}return r(t,{getName:{value:function(){return this.getTag()}},insert:{value:function(t){var e=void 0===arguments[1]?0:arguments[1];this.group=t.append("g").attr("class","shape "+this.getName()).datum({z:e}),this.element=this.group.append(this.getTag()).datum({transform:"translate(0,0)"}),this.features={selectable:new a(this)}}},getFacade:{value:function(){return this.facade}},setAccessor:{value:function(t){this.accessor=t}},setDispatcher:{value:function(t){var e=this;this.dispatcher=t,t.on(s.SELECT_ALL,function(){return e.getFacade().select()}),t.on(s.DESELECT_ALL,function(){return e.getFacade().deselect()})}}}),t}();e.exports=u},{"./../dispatcher/Events.js":8,"./shape/feature/Selectable.js":6}],4:[function(t,e){"use strict";var n=function(t){return t&&t.__esModule?t["default"]:t},r=function(){function t(t,e){for(var n in e){var r=e[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(t,e)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)},a=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=n(t("./../Facade.js")),u=function(t){function e(){a(this,e),null!=t&&t.apply(this,arguments)}return i(e,t),r(e,{fill:{value:function(t){return this.attribute("fill",t)}}}),e}(s);e.exports=u},{"./../Facade.js":2}],5:[function(t,e){"use strict";var n=function(t){return t&&t.__esModule?t["default"]:t},r=function(){function t(t,e){for(var n in e){var r=e[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(t,e)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function l(t,e,n){var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var i=Object.getPrototypeOf(t);return null===i?void 0:l(i,e,n)}if("value"in r&&r.writable)return r.value;var a=r.get;return void 0===a?void 0:a.call(n)},a=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)},s=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},u=n(t("./../Shape.js")),o=n(t("./../facade/Rectangle.js")),c=function(t){function e(){s(this,e),i(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.facade=new o(this)}return a(e,t),r(e,{getTag:{value:function(){return"rect"}}}),e}(u);e.exports=c},{"./../Shape.js":3,"./../facade/Rectangle.js":4}],6:[function(t,e){"use strict";var n=function(){function t(t,e){for(var n in e){var r=e[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(t,e)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function t(e){var n=this;r(this,t),this.shape=e;var i=e.element,a=e.accessor.keyboard,s=e.getFacade();i.on("mousedown",function(){return n.clickDisabled?void(n.clickDisabled=!1):a.multiSelect?void s.selectInvert():(n.shape.accessor.deselectAll(),void s.select())}),e.element.call(d3.behavior.drag().on("drag",function(){n.clickDisabled=!0,s.shape.accessor.dragBBox()}))}return n(t,{select:{value:function(){this.shape.getFacade().selected=!0,this.shape.getFacade().fill("green"),this.shape.accessor.createBBox()}},deselect:{value:function(){this.shape.getFacade().selected=!1,this.shape.getFacade().fill("lightgrey"),this.shape.accessor.createBBox()}}}),t}();e.exports=i},{}],7:[function(t,e){"use strict";var n=function(){function t(t,e){for(var n in e){var r=e[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(t,e)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function t(){r(this,t),this.events=[]}return n(t,{send:{value:function(t,e){this.events.hasOwnProperty(t)&&this.events[t].forEach(function(t){return t(e)})}},on:{value:function(t,e){this.events.hasOwnProperty(t)||(this.events[t]=[]),this.events[t].push(e)}}}),t}();e.exports=i},{}],8:[function(t,e){"use strict";e.exports={SELECT_ALL:"select-all",DESELECT_ALL:"deselect",SELECTED:"selected"}},{}],9:[function(t,e){"use strict";var n=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},r=function(){function t(t,e){for(var n in e){var r=e[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(t,e)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},a=function(){function t(){i(this,t)}return r(t,{setAccessor:{value:function(t){this.accessor=t}},create:{value:function(t,e){var r,i,a,s=this;if(this.bBox&&this.bBox.remove(),0!==t.length){var u={minX:Number.MAX_VALUE,minY:Number.MAX_VALUE,maxX:Number.MIN_VALUE,maxY:Number.MIN_VALUE},o=function(t){u.minX=Math.min.apply(Math,n(t.map(function(t){return t.x}))),u.minY=Math.min.apply(Math,n(t.map(function(t){return t.y}))),u.maxX=Math.max.apply(Math,n(t.map(function(t){return t.x+t.width}))),u.maxY=Math.max.apply(Math,n(t.map(function(t){return t.y+t.height})))};o(t.map(function(t){return t.boundingBox()})),this.bBox=e.append("rect").datum(u).classed("drag-box",!0).attr("x",function(t){return t.minX}).attr("y",function(t){return t.minY}).attr("width",function(t){return t.maxX-t.minX}).attr("height",function(t){return t.maxY-t.minY});var c=["dragstart",function(){return s.dragStart()}],l=["drag",function(){return s.drag()}],h=["dragend",function(){return s.dragEnd()}];this.bBox.call((r=(i=(a=d3.behavior.drag()).on.apply(a,c)).on.apply(i,l)).on.apply(r,h))}}},dragStart:{value:function(){var t=void 0===arguments[0]?null:arguments[0],e=void 0===arguments[1]?null:arguments[1];console.log("Ah"),this.start={x:null!==t?t:d3.event.sourceEvent.clientX-parseInt(this.bBox.attr("x")),y:null!==e?e:d3.event.sourceEvent.clientY-parseInt(this.bBox.attr("y"))}}},drag:{value:function(){var t=void 0===arguments[0]?null:arguments[0],e=void 0===arguments[1]?null:arguments[1],n=void 0===arguments[2]?10:arguments[2];t=null!==t?t:d3.event.sourceEvent.clientX,e=null!==e?e:d3.event.sourceEvent.clientY;var r=t-this.start.x,i=e-this.start.y,a=Math.ceil(r/n)*n,s=Math.ceil(i/n)*n;this.bBox.datum().x=a,this.bBox.attr("x",a),this.bBox.datum().y=s,this.bBox.attr("y",s)}},dragEnd:{value:function(){}}}),t}();e.exports=a},{}],10:[function(t,e){"use strict";e.exports={reorder:function(t,e){var n=t.size();e.datum().z<1&&(e.datum().z=1),e.datum().z>n&&(e.datum().z=n);var r=e.datum().z,i=1;t.sort(function(t,e){return t.z-e.z}),t[0].forEach(function(t){if(t!==e.node()){i===r&&i++;var n=d3.select(t),a=n.datum();a.z=i++,n.datum(a)}}),t.sort(function(t,e){return t.z-e.z})}}},{}]},{},[1]);